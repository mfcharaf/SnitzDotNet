var opentags;var crlf2br=true;var noparse=false;var urlstart=-1;var tagname_re=/^\/?(?:b|i|u|h1|h2|h3|samp|code(?:=[a-z]{1,9})?|colou?r|gold|orange|pink|grey|black|silver|gray|white|maroon|red|purple|fuchsia|green|lime|olive|yellow|navy|blue|teal|aqua|size(?:=[0-9]{1,3})?|noparse|url|img(?:=[a-z]{4,})?|video|s|q|quote|ltr|rtl|br|hr|left|right|center|file|list(?:=[a-z0-9]{1,3})?|[\*]|table|tr|td|th)$/;var color_re=/^(:?gold|orange|pink|black|silver|gray|white|maroon|red|purple|fuchsia|green|lime|olive|yellow|navy|blue|teal|aqua|#(?:[0-9a-f]{3})?[0-9a-f]{3})$/i;var number_re=/^[\\.0-9,]{1,8}$/i;var uri_re=/^[-;\/\?:@&=\+\$,_\.!~\*'\(\)%0-9a-z]{1,512}$/i;var postfmt_re=/([\r\n])|(?:\[([a-z\*]{1,16}|h[1-4]{1,16})(?:[= ]([^\x00-\x1F'\(\)<>\[\]]{1,256}))?\])|(?:\[\/([a-z\*]{1,16}|h[1-4]{1}|[a-z]{1,16}=[a-z0-9]{0,3})\])/ig;function taginfo_t(a,b){this.bbtag=a;this.etag=b}function isValidTag(a){if(!a||!a.length){return false}return tagname_re.test(a)}function textToHtmlCB(g,c,d,e,f,h,i){if(c&&c.length){if(!crlf2br){return g}switch(c){case"\r":return"";case"\n":return"<br/>";case"\r\n":return"<br/>"}}if(isValidTag(d)){if(noparse){return g}if(opentags.length&&opentags[opentags.length-1].bbtag=="url"&&urlstart>=0){return"["+d+"]"}switch(d){case"code":opentags.push(new taginfo_t(d,"</pre>"));crlf2br=false;if(!e){e="csharp"}return"<pre class='brush: "+e+"'>";case"video":opentags.push(new taginfo_t(d,"</iframe></body>"));if(e.length){e=e.replace(/"/ig,"")}if(e.indexOf("http")>0){return'<iframe src="'+e+'">'}return'<iframe src="http://youtu.be/'+e+'">';case"list":if(!e||!number_re.test(e)){opentags.push(new taginfo_t(d,"</ul>"));crlf2br=false;return"<ul>"}else{opentags.push(new taginfo_t(d,"</ol>"));crlf2br=false;return"<ol>"}case"*":opentags.push(new taginfo_t(d,"</li>"));crlf2br=false;return"<li>";case"color":case"colour":if(!e||!color_re.test(e)){e="inherit"}opentags.push(new taginfo_t(d,"</span>"));return'<span style="color: '+e+'">';case"gold":case"orange":case"black":case"pink":case"silver":case"gray":case"grey":case"white":case"maroon":case"purple":case"red":case"fuchsia":case"lime":case"olive":case"yellow":case"navy":case"blue":case"teal":case"aqua":case"green":if(!d||!color_re.test(d)){e="inherit"}else{e=d}opentags.push(new taginfo_t(d,"</span>"));return'<span style="color: '+e+'">';case"size":if(!e||!number_re.test(e)){e="1"}opentags.push(new taginfo_t(d,"</span>"));return'<span style="font-size: '+Math.min(Math.max(e*0.5,0.85),3)+'em">';case"s":opentags.push(new taginfo_t(d,"</span>"));return'<span style="text-decoration: line-through">';case"ltr":case"rtl":opentags.push(new taginfo_t(d,"</span>"));return'<span style="direction: '+d+'">';case"center":opentags.push(new taginfo_t(d,"</p>"));return'<p style="text-align:'+d+';">';break;case"left":case"right":opentags.push(new taginfo_t(d,"</p>"));return'<p style="text-align:'+d+';">';case"noparse":noparse=true;return"";case"img":var a='"/>';opentags.push(new taginfo_t(d,a));var b='<img style="width:auto !important;max-width:99% !important;" src="';if(e){b='<img style="width:auto !important;max-width:99% !important;float:'+e+'" src="'}return b;case"url":opentags.push(new taginfo_t(d,"</a>"));if(e){e=e.replace(/\"/g,"")}if(e&&uri_re.test(e)){urlstart=-1;return'<a href="'+e+'" class="postlink" target="'+urltarget+'">'}urlstart=g.length+h;return'<a class="postlink" target="'+urltarget+'" href="';case"file":opentags.push(new taginfo_t(d,'"><img src="/images/attach.png"/></a>'));return'Attachment: <a title="download '+e+'" href="';case"q":case"quote":if(e&&e.length){e=e.replace(/\"/g,"")}opentags.push(new taginfo_t(d,"</span></blockquote>"));return e&&e.length&&uri_re.test(e)?'<blockquote class="quoteMessage" ><em>Originally posted by '+e+"</em></br><span>":'<blockquote class="quoteMessage"><span>';case"table":opentags.push(new taginfo_t(d,"</table>"));if(!e){return"<table>"}else{return"<table "+e+">"}case"br":case"hr":return"<"+d+"/>";default:opentags.push(new taginfo_t(d,"</"+d+">"));return"<"+d+">"}}if(isValidTag(f)){if(noparse){if(f=="noparse"){noparse=false;return""}return"[/"+f+"]"}mx=f.toString().replace(/size(?:=[0-9]{1,3})?/ig,"size");mx=mx.replace(/list(?:=[0-9a-z,]{1,9})/ig,"list");mx=mx.replace(/code(?:=[a-z]{1,9})/ig,"code");if(!opentags.length||opentags[opentags.length-1].bbtag!=mx){return'<span style="color: red">[/'+f+"]</span>"}if(f=="url"){if(urlstart>0){return'">'+i.substr(urlstart,h-urlstart)+opentags.pop().etag}return opentags.pop().etag}else{if(f=="code"){crlf2br=true}}return opentags.pop().etag}if(noparse){if(d=="/noparse"){noparse=false;return""}return"[/"+f+"]"}return g}function parseBBCode(b){var c,a;crlf2br=true;if(opentags==null||opentags.length){opentags=new Array(0)}c=b.replace(postfmt_re,textToHtmlCB);if(noparse){noparse=false}if(opentags.length){a=new String();if(opentags[opentags.length-1].bbtag=="url"){opentags.pop();a+='">'+b.substr(urlstart,b.length-urlstart)+"</a>"}while(opentags.length){a+=opentags.pop().etag}}return a?c+a:c};